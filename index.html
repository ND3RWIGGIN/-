<!DOCTYPE html>
<html lang="en">

<head>
  <title>nd3rwiggin</title>
  <style>
    body {
      display: flex;
      flex-direction: column; /* Stacks the elements vertically */
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background-color: #191f41; /* Dark blue background */
      color: #c8d4e4; /* Light greyish blue text */
      font-family: Arial, sans-serif;
      text-align: center; /* Centers the text */
    }

    h1 {
      font-size: 3rem;
    }

    h2 {
      margin-top: 5px; /* Adds some space between h1 and h2 */
      font-size: 1.5rem;
    }

    #countdown {
      margin-top: 20px;
      font-size: 1.2rem;
    }

    #chat-container {
      margin-top: 30px;
      width: 320px;
      max-height: 400px;
      display: flex;
      flex-direction: column;
      background-color: #2a2f4f;
      border: 1px solid #c8d4e4;
      border-radius: 5px;
      padding: 10px;
    }

    #chat-box {
      flex-grow: 1;
      overflow-y: auto;
      padding: 5px;
      font-size: 0.9rem;
      border-bottom: 1px solid #48508a;
      max-height: 300px;
      color: #c8d4e4;
      text-align: left;
    }

    #chat-input-container {
      margin-top: 10px;
      display: flex;
    }

    #chat-input {
      flex-grow: 1;
      padding: 8px;
      border: none;
      font-size: 1rem;
      background-color: #3b4166;
      color: #c8d4e4;
      border-radius: 3px 0 0 3px;
    }

    #chat-input::placeholder {
      color: #9aa7c2;
    }

    #send-btn {
      padding: 8px 15px;
      background-color: #48508a;
      color: #c8d4e4;
      border: none;
      cursor: pointer;
      border-radius: 0 3px 3px 0;
    }

    /* Passcode lock styles */
    #lock-screen {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      width: 100vw;
      position: fixed;
      top: 0; left: 0;
      background-color: #191f41;
      color: #c8d4e4;
      z-index: 9999;
    }

    #passcode-input {
      padding: 10px;
      font-size: 1.2rem;
      border-radius: 5px;
      border: none;
      margin-top: 10px;
      width: 250px;
      text-align: center;
      background-color: #3b4166;
      color: #c8d4e4;
    }

    #unlock-btn {
      margin-top: 15px;
      padding: 10px 20px;
      font-size: 1rem;
      background-color: #48508a;
      border: none;
      color: #c8d4e4;
      border-radius: 5px;
      cursor: pointer;
    }

    #error-msg {
      color: #ff6b6b;
      margin-top: 10px;
      height: 1.2em;
    }
  </style>
</head>

<body>
  <!-- Lock screen -->
  <div id="lock-screen">
    <h2>Enter Passcode to Access</h2>
    <input type="password" id="passcode-input" placeholder="Passcode" />
    <button id="unlock-btn">Unlock</button>
    <div id="error-msg"></div>
  </div>

  <!-- Main content, initially hidden -->
  <div id="main-content" style="display:none;">
    <h1> Day 5; </h1>

    <br>

    <h2> Well yeah, and I'm sad, but at the same time I'm really happy that something could make me feel that sad. It's like, it makes me feel alive, you know? It makes me feel human. And the only way I could feel this sad now is if I felt somethin' really good before. So I have to take the bad with the good, so I guess what I'm feelin' is like a, beautiful sadness. I guess that sounds stupid.</h2>

    <h3> - Butters, South Park</h3>

    <div id="countdown"></div>

    <div id="chat-container">
      <div id="chat-box"></div>
      <div id="chat-input-container">
        <input type="text" id="chat-input" placeholder="Type your message..." />
        <button id="send-btn">Send</button>
      </div>
    </div>
  </div>

  <script type="module">
    // Firebase imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import {
      getDatabase,
      ref,
      push,
      onChildAdded,
      query,
      orderByChild,
      endAt,
      get,
      remove
    } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBUmJ9k5pS62TzIkRHswO2lJLnaeRIfGmE",
      authDomain: "jess-chat-box.firebaseapp.com",
      projectId: "jess-chat-box",
      storageBucket: "jess-chat-box.firebasestorage.app",
      messagingSenderId: "414967828897",
      appId: "1:414967828897:web:89045ed9bd4b3257c4bbe0",
      measurementId: "G-P1EVKQ9M7E"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Elements
    const lockScreen = document.getElementById("lock-screen");
    const mainContent = document.getElementById("main-content");
    const passcodeInput = document.getElementById("passcode-input");
    const unlockBtn = document.getElementById("unlock-btn");
    const errorMsg = document.getElementById("error-msg");

    const chatBox = document.getElementById("chat-box");
    const chatInput = document.getElementById("chat-input");
    const sendBtn = document.getElementById("send-btn");

    const messagesRef = ref(db, "messages");

    // Passcode - change this to your desired secret passcode
    const SECRET_PASSCODE = "MO-CHAT-IMO";

    // Unlock function
    function unlock() {
      const enteredCode = passcodeInput.value.trim();
      if (enteredCode === SECRET_PASSCODE) {
        lockScreen.style.display = "none";
        mainContent.style.display = "flex";
        errorMsg.textContent = "";
        startApp();
      } else {
        errorMsg.textContent = "Incorrect passcode. Try again.";
        passcodeInput.value = "";
      }
    }

    unlockBtn.addEventListener("click", unlock);
    passcodeInput.addEventListener("keydown", e => {
      if (e.key === "Enter") {
        unlock();
      }
    });

    // Main app logic (chat, countdown, message deletion)
    function startApp() {
      // Display new messages
      onChildAdded(messagesRef, (data) => {
        const msg = data.val();
        const div = document.createElement("div");
        const time = new Date(msg.timestamp).toLocaleTimeString();
        div.textContent = `[${time}] ${msg.name}: ${msg.text}`;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
      });

      // Delete messages older than 30 days
      async function deleteOldMessages() {
        const thirtyDaysAgo = Date.now() - (30 * 24 * 60 * 60 * 1000);
        const oldMessagesQuery = query(messagesRef, orderByChild("timestamp"), endAt(thirtyDaysAgo));
        const snapshot = await get(oldMessagesQuery);
        snapshot.forEach((childSnapshot) => {
          remove(ref(db, 'messages/' + childSnapshot.key));
        });
      }

      // Send message
      async function sendMessage() {
        const text = chatInput.value.trim();
        if (!text) return;

        const message = {
          name: "Visitor", // Customize if you want
          text,
          timestamp: Date.now()
        };

        await push(messagesRef, message);
        chat
