<!DOCTYPE html>
<html lang="en">
<head>
  <title>nd3rwiggin</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      height: 100vh;
      margin: 0;
      background-color: #191f41;
      color: #c8d4e4;
      font-family: Arial, sans-serif;
      text-align: center;
      overflow: hidden;
    }

    #quote-container {
      padding: 40px 20px 20px;
      font-size: 1.5rem;
      user-select: none;
    }

    #quote-container em {
      font-size: 1rem;
      font-style: italic;
      opacity: 0.8;
    }

    #main-content {
      flex-grow: 1;
      overflow-y: auto;
      display: none;
      align-items: center;
      flex-direction: column;
      padding-bottom: 30px;
    }

    .screen {
      position: fixed;
      inset: 0;
      background: #191f41;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }

    .input-field {
      padding: 10px;
      font-size: 1.1rem;
      margin-top: 10px;
      width: 250px;
      text-align: center;
      background-color: #3b4166;
      border: none;
      color: #c8d4e4;
      border-radius: 5px;
    }

    .btn {
      margin-top: 15px;
      padding: 10px 20px;
      background-color: #48508a;
      border: none;
      color: #c8d4e4;
      border-radius: 5px;
      cursor: pointer;
    }

    #error-msg, #auth-error {
      color: #ff6b6b;
      height: 1.2em;
      margin-top: 10px;
    }

    /* Schedule */
    #schedule-container {
      margin-top: 30px;
      width: 90%;
      max-width: 700px;
    }

    #schedule-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
      margin-top: 15px;
    }

    .schedule-cell {
      background-color: #2a2f4f;
      border: 1px solid #48508a;
      min-height: 80px;
      padding: 6px;
      font-size: 0.8rem;
      border-radius: 5px;
      cursor: pointer;
      outline: none;
    }

    .schedule-cell:focus {
      box-shadow: 0 0 0 2px #48508a;
    }

    #color-picker {
      margin-top: 12px;
      display: flex;
      justify-content: center;
      gap: 10px;
    }

    #color-picker button {
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      color: #fff;
    }

    /* Chat */
    #chat-container {
      margin-top: 30px;
      width: 320px;
      background: #2a2f4f;
      border: 1px solid #c8d4e4;
      border-radius: 5px;
      padding: 10px;
      display: flex;
      flex-direction: column;
    }

    #chat-box {
      flex-grow: 1;
      overflow-y: auto;
      font-size: 0.9rem;
      text-align: left;
      margin-bottom: 10px;
    }

    #chat-input-container {
      display: flex;
    }

    #chat-input {
      flex-grow: 1;
      padding: 8px;
      background: #3b4166;
      border: none;
      color: #c8d4e4;
    }

    #send-btn {
      padding: 8px 14px;
      background: #48508a;
      border: none;
      color: #c8d4e4;
      cursor: pointer;
    }
  </style>
</head>

<body>

<!-- Lock Screen -->
<div class="screen" id="lock-screen">
  <h2>Enter Passcode</h2>
  <input class="input-field" type="password" id="passcode-input" />
  <button class="btn" id="unlock-btn">Unlock</button>
  <div id="error-msg"></div>
</div>

<!-- Auth -->
<div class="screen" id="auth-screen" style="display:none;">
  <h2>Log In / Sign Up</h2>
  <input class="input-field" type="email" id="auth-email" placeholder="Email">
  <input class="input-field" type="password" id="auth-password" placeholder="Password">
  <button class="btn" id="login-btn">Log In</button>
  <button class="btn" id="signup-btn">Sign Up</button>
  <div id="auth-error"></div>
</div>

<div id="quote-container">
  "Sometimes it just feels like I'm too late"
  <br>
  <em>nd3r, J12</em>
</div>

<div id="main-content">

  <!-- Schedule -->
  <div id="schedule-container">
    <h2>Shared Schedule</h2>
    <p style="font-size:0.85rem; opacity:0.8;">Click to color • Type to edit • Auto-syncs</p>

    <div id="schedule-grid"></div>

    <div id="color-picker">
      <button data-color="#4caf50" style="background:#4caf50">Free</button>
      <button data-color="#ff9800" style="background:#ff9800">School</button>
      <button data-color="#2196f3" style="background:#2196f3">Work</button>
      <button data-color="#9c27b0" style="background:#9c27b0">Other</button>
    </div>
  </div>

  <!-- Chat -->
  <div id="chat-container">
    <div id="chat-box"></div>
    <div id="chat-input-container">
      <input id="chat-input" placeholder="Type..." />
      <button id="send-btn">Send</button>
    </div>
  </div>

</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
  import { getDatabase, ref, push, onChildAdded, onValue, set } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";
  import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBUmJ9k5pS62TzIkRHswO2lJLnaeRIfGmE",
    authDomain: "jess-chat-box.firebaseapp.com",
    projectId: "jess-chat-box",
    storageBucket: "jess-chat-box.appspot.com",
    messagingSenderId: "414967828897",
    appId: "1:414967828897:web:89045ed9bd4b3257c4bbe0"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const auth = getAuth(app);

  // Passcode
  unlock-btn.onclick = () => {
    if (passcode-input.value === "092603") {
      lock-screen.style.display = "none";
      onAuthStateChanged(auth, user => {
        user ? startApp(user) : auth-screen.style.display = "flex";
      });
    } else {
      error-msg.textContent = "Incorrect passcode.";
    }
  };

  login-btn.onclick = () =>
    signInWithEmailAndPassword(auth, auth-email.value, auth-password.value)
      .then(res => startApp(res.user))
      .catch(e => auth-error.textContent = e.message);

  signup-btn.onclick = () =>
    createUserWithEmailAndPassword(auth, auth-email.value, auth-password.value)
      .then(res => startApp(res.user))
      .catch(e => auth-error.textContent = e.message);

  function startApp(user) {
    auth-screen.style.display = "none";
    main-content.style.display = "flex";

    /* Schedule */
    const scheduleRef = ref(db, "schedule");
    const grid = document.getElementById("schedule-grid");
    const days = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];
    let selectedColor = "#4caf50";

    days.forEach(day => {
      const cell = document.createElement("div");
      cell.className = "schedule-cell";
      cell.contentEditable = true;
      cell.dataset.day = day;

      cell.onclick = () => {
        cell.style.backgroundColor = selectedColor;
        set(ref(db, "schedule/" + day), {
          text: cell.innerText,
          color: selectedColor
        });
      };

      cell.oninput = () => {
        set(ref(db, "schedule/" + day), {
          text: cell.innerText,
          color: cell.style.backgroundColor
        });
      };

      grid.appendChild(cell);
    });

    onValue(scheduleRef, snap => {
      const data = snap.val() || {};
      document.querySelectorAll(".schedule-cell").forEach(c => {
        const d = data[c.dataset.day];
        if (d) {
          c.innerText = d.text || "";
          c.style.backgroundColor = d.color || "#2a2f4f";
        }
      });
    });

    document.querySelectorAll("#color-picker button").forEach(btn =>
      btn.onclick = () => selectedColor = btn.dataset.color
    );

    /* Chat */
    const chatRef = ref(db, "messages");
    onChildAdded(chatRef, snap => {
      const m = snap.val();
      const div = document.createElement("div");
      div.textContent = `[${new Date(m.timestamp).toLocaleTimeString()}] ${m.name}: ${m.text}`;
      chat-box.appendChild(div);
      chat-box.scrollTop = chat-box.scrollHeight;
    });

    send-btn.onclick = send;
    chat-input.onkeydown = e => e.key === "Enter" && send();

    function send() {
      if (!chat-input.value.trim()) return;
      push(chatRef, {
        name: user.email,
        text: chat-input.value,
        timestamp: Date.now()
      });
      chat-input.value = "";
    }
  }
</script>
</body>
</html>
