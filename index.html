<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Shared Space</title>

<style>
body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: #0f1220;
  color: #fff;
  display: flex;
  justify-content: center;
}

#main {
  width: 100%;
  max-width: 1100px;
  padding: 12px;
}

/* ---------- SCHEDULE ---------- */

#schedule-scroll {
  overflow-x: auto;
}

#schedule-grid {
  display: grid;
  grid-template-columns: 60px repeat(7, 1fr);
  min-width: 900px;
  gap: 4px;
}

.day-header, .hour-label {
  font-size: 0.7rem;
  opacity: 0.7;
  text-align: center;
}

.hour-label {
  display: flex;
  align-items: center;
  justify-content: center;
}

.hour-cell {
  display: flex;
  min-height: 60px;
  border: 1px solid #3a3f6b;
  border-radius: 4px;
  overflow: hidden;
}

.half {
  flex: 1;
  padding: 4px;
  font-size: 0.7rem;
  outline: none;
}

.half.me {
  border-right: 1px solid #3a3f6b;
}

/* ---------- COLOR PICKER ---------- */

#colors {
  margin: 10px 0;
  display: flex;
  gap: 8px;
}

#colors button {
  padding: 6px 10px;
  border: none;
  border-radius: 4px;
  color: #fff;
  cursor: pointer;
}

/* ---------- CHAT ---------- */

#chat {
  margin-top: 20px;
  border-top: 1px solid #3a3f6b;
  padding-top: 10px;
}

#chat-box {
  height: 220px;
  overflow-y: auto;
  border: 1px solid #3a3f6b;
  padding: 6px;
  margin-bottom: 6px;
}

.message {
  font-size: 0.8rem;
  margin-bottom: 4px;
}

#chat-input {
  width: 80%;
}

</style>
</head>

<body>
<div id="main">

<h2>Weekly Schedule</h2>

<div id="colors">
  <button data-color="#4caf50">Free</button>
  <button data-color="#ff9800">School</button>
  <button data-color="#2196f3">Work</button>
  <button data-color="#9c27b0">Other</button>
</div>

<div id="schedule-scroll">
  <div id="schedule-grid"></div>
</div>

<div id="chat">
  <h3>Chat</h3>
  <div id="chat-box"></div>
  <input id="chat-input" placeholder="Message..." />
  <button id="send">Send</button>
</div>

</div>

<script type="module">
/* ---------- FIREBASE ---------- */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, set, onValue, push } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

/* ðŸ”´ PASTE YOUR CONFIG HERE */
const firebaseConfig = {
  apiKey: "YOUR_KEY",
  authDomain: "YOUR_DOMAIN",
  databaseURL: "YOUR_DB_URL",
  projectId: "YOUR_ID",
  storageBucket: "YOUR_BUCKET",
  messagingSenderId: "YOUR_SENDER",
  appId: "YOUR_APP"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ---------- SCHEDULE ---------- */

const days = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];
const hours = Array.from({length: 15}, (_,i) => i + 8);
const grid = document.getElementById("schedule-grid");

grid.appendChild(document.createElement("div"));
days.forEach(d => {
  const h = document.createElement("div");
  h.textContent = d;
  h.className = "day-header";
  grid.appendChild(h);
});

let selectedColor = "#4caf50";

document.querySelectorAll("#colors button").forEach(b => {
  b.onclick = () => selectedColor = b.dataset.color;
});

hours.forEach(hour => {
  const label = document.createElement("div");
  label.className = "hour-label";
  label.textContent = `${hour}:00`;
  grid.appendChild(label);

  days.forEach(day => {
    const cell = document.createElement("div");
    cell.className = "hour-cell";

    ["me","river"].forEach(owner => {
      const half = document.createElement("div");
      half.className = `half ${owner}`;
      half.contentEditable = true;
      half.dataset.day = day;
      half.dataset.hour = hour;
      half.dataset.owner = owner;

      half.onclick = () => {
        half.style.backgroundColor = selectedColor;
        saveHalf(half);
      };

      half.oninput = () => saveHalf(half);

      cell.appendChild(half);
    });

    grid.appendChild(cell);
  });
});

function saveHalf(half) {
  const { day, hour, owner } = half.dataset;
  set(ref(db, `schedule/${day}/${hour}/${owner}`), {
    text: half.innerText,
    color: half.style.backgroundColor || ""
  });
}

/* ðŸ”’ Cursor-safe sync */
onValue(ref(db,"schedule"), snap => {
  const data = snap.val() || {};
  document.querySelectorAll(".half").forEach(h => {
    if (document.activeElement === h) return;
    const { day, hour, owner } = h.dataset;
    const saved = data?.[day]?.[hour]?.[owner];
    if (saved) {
      h.innerText = saved.text || "";
      h.style.backgroundColor = saved.color || "";
    }
  });
});

/* ---------- CHAT (NEW PATH = EMPTY) ---------- */

const chatBox = document.getElementById("chat-box");
const chatInput = document.getElementById("chat-input");
const sendBtn = document.getElementById("send");

const chatRef = ref(db, "chat_river"); // ðŸ”¥ NEW = NO OLD MESSAGES

sendBtn.onclick = () => {
  if (!chatInput.value.trim()) return;
  push(chatRef, { text: chatInput.value });
  chatInput.value = "";
};

onValue(chatRef, snap => {
  chatBox.innerHTML = "";
  snap.forEach(m => {
    const d = document.createElement("div");
    d.className = "message";
    d.textContent = m.val().text;
    chatBox.appendChild(d);
  });
  chatBox.scrollTop = chatBox.scrollHeight;
});
</script>
</body>
</html>
