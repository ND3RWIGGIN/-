<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>nd3rwiggin</title>

<style>

/* =========================================================
   BASE
   ========================================================= */
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #191f41;
  color: #c8d4e4;
  display: flex;
  flex-direction: column;
  height: 100vh;
  overflow: hidden;
}

button {
  font-family: inherit;
}

/* =========================================================
   SCREENS
   ========================================================= */
.screen {
  position: fixed;
  inset: 0;
  background: #191f41;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

.input-field {
  padding: 10px;
  font-size: 1.1rem;
  margin-top: 10px;
  width: 260px;
  text-align: center;
  border: none;
  border-radius: 6px;
  background: #3b4166;
  color: #c8d4e4;
}

.btn {
  margin-top: 15px;
  padding: 10px 20px;
  background: #48508a;
  border: none;
  color: #c8d4e4;
  border-radius: 6px;
  cursor: pointer;
}

#error-msg,
#auth-error {
  color: #ff6b6b;
  margin-top: 10px;
  min-height: 1.2em;
}

/* =========================================================
   HEADER
   ========================================================= */
#quote-container {
  padding: 30px 20px 10px;
  text-align: center;
  font-size: 1.4rem;
  user-select: none;
}

#quote-container em {
  font-size: 0.9rem;
  opacity: 0.8;
}

/* =========================================================
   MAIN
   ========================================================= */
#main-content {
  flex: 1;
  overflow-y: auto;
  padding: 10px;
  display: none;
}

#online-users-container {
  font-size: 0.85rem;
  margin-bottom: 10px;
}

/* =========================================================
   TOOLS
   ========================================================= */
#colors {
  display: flex;
  gap: 8px;
  margin: 10px 0;
}

#colors button {
  padding: 6px 10px;
  border-radius: 4px;
  border: none;
  cursor: pointer;
  font-size: 0.75rem;
  color: #000;
}

#eraser-btn {
  background: #e53935;
  color: #fff;
}

/* =========================================================
   SCHEDULE
   ========================================================= */
#schedule-scroll {
  overflow-x: auto;
}

#schedule-grid {
  display: grid;
  grid-template-columns: 60px repeat(7, 1fr);
  min-width: 900px;
  gap: 4px;
}

.day-header,
.hour-label {
  font-size: 0.7rem;
  text-align: center;
  opacity: 0.7;
}

.hour-cell {
  display: flex;
  min-height: 60px;
  border: 1px solid #48508a;
  border-radius: 4px;
  overflow: hidden;
}

.half {
  flex: 1;
  padding: 4px;
  font-size: 0.7rem;
  outline: none;
  word-break: break-word;
}

.half.left {
  border-right: 1px solid #48508a;
}

/* =========================================================
   CHAT
   ========================================================= */
#chat-container {
  margin-top: 20px;
  border-top: 1px solid #48508a;
  padding-top: 10px;
}

#chat-box {
  height: 220px;
  overflow-y: auto;
  border: 1px solid #48508a;
  padding: 6px;
  margin-bottom: 6px;
  font-size: 0.85rem;
}

#chat-input {
  width: calc(100% - 60px);
  padding: 6px;
  background: #3b4166;
  border: none;
  color: #c8d4e4;
}

</style>
</head>

<body>

<!-- LOCK -->
<div class="screen" id="lock-screen">
  <h2>Enter Passcode</h2>
  <input class="input-field" id="passcode-input" type="password" />
  <button class="btn" id="unlock-btn" type="button">Unlock</button>
  <div id="error-msg"></div>
</div>

<!-- AUTH -->
<div class="screen" id="auth-screen" style="display:none;">
  <h2>Log In / Sign Up</h2>
  <input class="input-field" id="auth-email" type="email" placeholder="Email" />
  <input class="input-field" id="auth-password" type="password" placeholder="Password" />
  <button class="btn" id="login-btn" type="button">Log In</button>
  <button class="btn" id="signup-btn" type="button">Sign Up</button>
  <div id="auth-error"></div>
</div>

<div id="quote-container">
  “Sometimes it just feels like I’m too late”<br />
  <em>nd3r, J12</em>
</div>

<div id="main-content">

  <div id="online-users-container">
    <strong>Online:</strong>
    <ul id="online-users-list"></ul>
  </div>

  <div id="colors">
    <button data-color="#4caf50" style="background:#4caf50;">Free</button>
    <button data-color="#ff9800" style="background:#ff9800;">School</button>
    <button data-color="#2196f3" style="background:#2196f3;">Work</button>
    <button data-color="#ffeb3b" style="background:#ffeb3b;">Other</button>
    <button id="eraser-btn">Eraser</button>
  </div>

  <div id="schedule-scroll">
    <div id="schedule-grid"></div>
  </div>

  <div id="chat-container">
    <div id="chat-box"></div>
    <input id="chat-input" placeholder="Type..." />
    <button id="send-btn" type="button">Send</button>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
import { getDatabase, ref, set, onValue, push, remove, onDisconnect } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";

/* =========================================================
   FIREBASE + AUTH
   ========================================================= */
const firebaseConfig = {
  apiKey: "AIzaSyBUmJ9k5pS62TzIkRHswO2lJLnaeRIfGmE",
  authDomain: "jess-chat-box.firebaseapp.com",
  projectId: "jess-chat-box",
  storageBucket: "jess-chat-box.appspot.com",
  messagingSenderId: "414967828897",
  appId: "1:414967828897:web:89045ed9bd4b3257c4bbe0"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);

/* =========================================================
   UNLOCK
   ========================================================= */
unlockBtn.onclick = () => {
  if (passcodeInput.value === "092603") {
    lockScreen.style.display = "none";
    onAuthStateChanged(auth, user => {
      if (user) start(user);
      else authScreen.style.display = "flex";
    });
  } else {
    errorMsg.textContent = "Wrong passcode.";
  }
};

/* =========================================================
   AUTH
   ========================================================= */
loginBtn.onclick = () =>
  signInWithEmailAndPassword(auth, authEmail.value, authPassword.value)
    .catch(e => authError.textContent = e.message);

signupBtn.onclick = () =>
  createUserWithEmailAndPassword(auth, authEmail.value, authPassword.value)
    .catch(e => authError.textContent = e.message);

/* =========================================================
   SCHEDULE
   ========================================================= */
const days = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];
const hours = Array.from({ length: 15 }, (_, i) => i + 8);
const grid = document.getElementById("schedule-grid");

let selectedColor = "#4caf50";
let eraserMode = false;

document.querySelectorAll("#colors button[data-color]").forEach(btn => {
  btn.onclick = () => {
    selectedColor = btn.dataset.color;
    eraserMode = false;
  };
});

eraser-btn.onclick = () => {
  eraserMode = true;
};

function start(user) {
  mainContent.style.display = "block";
  authScreen.style.display = "none";
  buildSchedule(user.email);
  syncSchedule();
  setupChat(user.email);
}

function buildSchedule(email) {
  grid.innerHTML = "";

  grid.appendChild(document.createElement("div"));
  days.forEach(d => {
    const h = document.createElement("div");
    h.textContent = d;
    h.className = "day-header";
    grid.appendChild(h);
  });

  const mySide = email === "eesanana@gmail.com" ? "right" : "left";

  hours.forEach(hr => {
    const label = document.createElement("div");
    label.textContent = hr + ":00";
    label.className = "hour-label";
    grid.appendChild(label);

    days.forEach(day => {
      const cell = document.createElement("div");
      cell.className = "hour-cell";

      ["left","right"].forEach(side => {
        const half = document.createElement("div");
        half.className = "half " + side;
        half.dataset.day = day;
        half.dataset.hour = hr;
        half.dataset.side = side;
        half.contentEditable = side === mySide;

        half.onclick = () => {
          if (side !== mySide) {
            alert("NOT YOUR SIDE SILLY");
            return;
          }

          if (eraserMode) {
            half.innerText = "";
            half.style.backgroundColor = "";
            remove(ref(db, `schedule/${day}/${hr}/${side}`));
            return;
          }

          half.style.backgroundColor = selectedColor;
          saveHalf(day, hr, side, half);
        };

        half.oninput = () => {
          if (side === mySide) saveHalf(day, hr, side, half);
        };

        cell.appendChild(half);
      });

      grid.appendChild(cell);
    });
  });
}

function syncSchedule() {
  onValue(ref(db, "schedule"), snap => {
    document.querySelectorAll(".half").forEach(h => {
      h.innerText = "";
      h.style.backgroundColor = "";
    });

    snap.forEach(daySnap => {
      daySnap.forEach(hourSnap => {
        Object.entries(hourSnap.val()).forEach(([side,val]) => {
          const sel = `.half[data-day="${daySnap.key}"][data-hour="${hourSnap.key}"][data-side="${side}"]`;
          const target = document.querySelector(sel);
          if (!target) return;
          target.innerText = val.text || "";
          target.style.backgroundColor = val.color || "";
        });
      });
    });
  });
}

function saveHalf(day, hour, side, el) {
  set(ref(db, `schedule/${day}/${hour}/${side}`), {
    text: el.innerText,
    color: el.style.backgroundColor
  });
}

/* =========================================================
   CHAT
   ========================================================= */
function setupChat(email) {
  const chatRef = ref(db, "chat_river");

  sendBtn.onclick = () => {
    if (!chatInput.value.trim()) return;
    push(chatRef, { name: email, text: chatInput.value, time: Date.now() });
    chatInput.value = "";
  };

  onValue(chatRef, snap => {
    chatBox.innerHTML = "";
    snap.forEach(m => {
      const d = document.createElement("div");
      d.textContent = `[${new Date(m.val().time).toLocaleTimeString()}] ${m.val().name}: ${m.val().text}`;
      chatBox.appendChild(d);
    });
    chatBox.scrollTop = chatBox.scrollHeight;
  });
}
</script>

</body>
</html>
