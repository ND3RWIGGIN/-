<!DOCTYPE html>
<html lang="en">
<head>
  <title>nd3rwiggin</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      background: #191f41;
      color: #c8d4e4;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      text-align: center;
    }

    #quote-container {
      padding: 35px 20px 20px;
      font-size: 1.4rem;
      user-select: none;
    }

    #quote-container em {
      font-size: 0.95rem;
      opacity: 0.75;
    }

    .screen {
      position: fixed;
      inset: 0;
      background: #191f41;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }

    .input-field {
      padding: 10px;
      font-size: 1.1rem;
      margin-top: 10px;
      width: 250px;
      text-align: center;
      background: #3b4166;
      border: none;
      color: #c8d4e4;
      border-radius: 5px;
    }

    .btn {
      margin-top: 15px;
      padding: 10px 20px;
      background: #48508a;
      border: none;
      color: #c8d4e4;
      border-radius: 5px;
      cursor: pointer;
    }

    #error-msg, #auth-error {
      color: #ff6b6b;
      margin-top: 10px;
      height: 1.2em;
    }

    #main-content {
      flex: 1;
      overflow-y: auto;
      display: none;
      padding-bottom: 40px;
      align-items: center;
      flex-direction: column;
    }

    /* ===== SCHEDULE ===== */
    #schedule-container {
      margin-top: 25px;
      width: 95%;
      max-width: 1100px;
    }

    #schedule-grid {
      display: grid;
      grid-template-columns: 60px repeat(7, 1fr);
      gap: 4px;
      margin-top: 10px;
      font-size: 0.75rem;
    }

    .time-label, .day-label {
      background: #2a2f4f;
      border: 1px solid #48508a;
      padding: 6px;
      font-weight: bold;
    }

    .schedule-cell {
      background: #2a2f4f;
      border: 1px solid #48508a;
      min-height: 45px;
      padding: 4px;
      cursor: pointer;
      outline: none;
    }

    .schedule-cell:focus {
      box-shadow: 0 0 0 2px #48508a;
    }

    #color-picker {
      margin-top: 10px;
      display: flex;
      gap: 10px;
      justify-content: center;
    }

    #color-picker button {
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      color: #fff;
    }

    /* ===== CHAT ===== */
    #chat-container {
      margin-top: 30px;
      width: 320px;
      background: #2a2f4f;
      border: 1px solid #c8d4e4;
      border-radius: 5px;
      padding: 10px;
      display: flex;
      flex-direction: column;
    }

    #chat-box {
      flex: 1;
      overflow-y: auto;
      text-align: left;
      font-size: 0.9rem;
      margin-bottom: 8px;
    }

    #chat-input-container {
      display: flex;
    }

    #chat-input {
      flex: 1;
      padding: 8px;
      background: #3b4166;
      border: none;
      color: #c8d4e4;
    }

    #send-btn {
      padding: 8px 14px;
      background: #48508a;
      border: none;
      color: #c8d4e4;
      cursor: pointer;
    }
  </style>
</head>

<body>

<div class="screen" id="lock-screen">
  <h2>Enter Passcode</h2>
  <input id="passcode-input" class="input-field" type="password">
  <button id="unlock-btn" class="btn">Unlock</button>
  <div id="error-msg"></div>
</div>

<div class="screen" id="auth-screen" style="display:none;">
  <h2>Log In / Sign Up</h2>
  <input id="auth-email" class="input-field" type="email" placeholder="Email">
  <input id="auth-password" class="input-field" type="password" placeholder="Password">
  <button id="login-btn" class="btn">Log In</button>
  <button id="signup-btn" class="btn">Sign Up</button>
  <div id="auth-error"></div>
</div>

<div id="quote-container">
  "Sometimes it just feels like I'm too late"<br>
  <em>nd3r, J12</em>
</div>

<div id="main-content">

  <div id="schedule-container">
    <h2>Weekly Schedule</h2>
    <p style="opacity:.8;font-size:.8rem;">Click to color â€¢ Type to edit â€¢ Live sync</p>
    <div id="schedule-grid"></div>

    <div id="color-picker">
      <button data-color="#4caf50" style="background:#4caf50">Free</button>
      <button data-color="#ff9800" style="background:#ff9800">School</button>
      <button data-color="#2196f3" style="background:#2196f3">Work</button>
      <button data-color="#9c27b0" style="background:#9c27b0">Other</button>
    </div>
  </div>

  <div id="chat-container">
    <div id="chat-box"></div>
    <div id="chat-input-container">
      <input id="chat-input" placeholder="Type...">
      <button id="send-btn">Send</button>
    </div>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
import { getDatabase, ref, push, onChildAdded, onValue, set, remove } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyBUmJ9k5pS62TzIkRHswO2lJLnaeRIfGmE",
  authDomain: "jess-chat-box.firebaseapp.com",
  projectId: "jess-chat-box",
  messagingSenderId: "414967828897",
  appId: "1:414967828897:web:89045ed9bd4b3257c4bbe0"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);

/* DOM */
const unlockBtn = document.getElementById("unlock-btn");
const passcodeInput = document.getElementById("passcode-input");
const lockScreen = document.getElementById("lock-screen");
const authScreen = document.getElementById("auth-screen");
const mainContent = document.getElementById("main-content");
const errorMsg = document.getElementById("error-msg");

const loginBtn = document.getElementById("login-btn");
const signupBtn = document.getElementById("signup-btn");
const authEmail = document.getElementById("auth-email");
const authPassword = document.getElementById("auth-password");
const authError = document.getElementById("auth-error");

const chatBox = document.getElementById("chat-box");
const chatInput = document.getElementById("chat-input");
const sendBtn = document.getElementById("send-btn");

/* PASSCODE */
unlockBtn.onclick = async () => {
  if (passcodeInput.value === "092603") {
    lockScreen.style.display = "none";

    // ðŸ”¥ HARD RESET CHAT
    await remove(ref(db, "messages"));

    onAuthStateChanged(auth, user =>
      user ? startApp(user) : authScreen.style.display = "flex"
    );
  } else {
    errorMsg.textContent = "Incorrect passcode.";
  }
};

/* AUTH */
loginBtn.onclick = () =>
  signInWithEmailAndPassword(auth, authEmail.value, authPassword.value)
    .then(r => startApp(r.user))
    .catch(e => authError.textContent = e.message);

signupBtn.onclick = () =>
  createUserWithEmailAndPassword(auth, authEmail.value, authPassword.value)
    .then(r => startApp(r.user))
    .catch(e => authError.textContent = e.message);

function startApp(user) {
  authScreen.style.display = "none";
  mainContent.style.display = "flex";

  /* ===== SCHEDULE ===== */
  const grid = document.getElementById("schedule-grid");
  const scheduleRef = ref(db, "schedule");
  const days = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];
  const hours = Array.from({length: 15}, (_, i) => i + 8);
  let selectedColor = "#4caf50";

  grid.innerHTML = "";

  grid.appendChild(document.createElement("div"));
  days.forEach(d => {
    const h = document.createElement("div");
    h.textContent = d;
    h.className = "day-label";
    grid.appendChild(h);
  });

  hours.forEach(hr => {
    const label = document.createElement("div");
    label.textContent = `${hr}:00`;
    label.className = "time-label";
    grid.appendChild(label);

    days.forEach(day => {
      const cell = document.createElement("div");
      cell.className = "schedule-cell";
      cell.contentEditable = true;
      cell.dataset.day = day;
      cell.dataset.hour = hr;

      cell.onclick = () => {
        cell.style.background = selectedColor;
        set(ref(db, `schedule/${day}/${hr}`), {
          text: cell.innerText,
          color: selectedColor
        });
      };

      cell.oninput = () =>
        set(ref(db, `schedule/${day}/${hr}`), {
          text: cell.innerText,
          color: cell.style.backgroundColor
        });

      grid.appendChild(cell);
    });
  });

  onValue(scheduleRef, snap => {
    const data = snap.val() || {};
    document.querySelectorAll(".schedule-cell").forEach(cell => {
      const d = data[cell.dataset.day]?.[cell.dataset.hour];
      if (d) {
        cell.innerText = d.text || "";
        cell.style.background = d.color || "#2a2f4f";
      }
    });
  });

  document.querySelectorAll("#color-picker button")
    .forEach(b => b.onclick = () => selectedColor = b.dataset.color);

  /* ===== CHAT ===== */
  const chatRef = ref(db, "messages");

  onChildAdded(chatRef, snap => {
    const m = snap.val();
    const div = document.createElement("div");
    div.textContent = `[${new Date(m.timestamp).toLocaleTimeString()}] ${m.name}: ${m.text}`;
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
  });

  sendBtn.onclick = () => {
    if (!chatInput.value.trim()) return;
    push(chatRef, {
      name: user.email,
      text: chatInput.value,
      timestamp: Date.now()
    });
    chatInput.value = "";
  };
}
</script>
</body>
</html>
